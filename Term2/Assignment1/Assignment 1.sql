
IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = 'CHARTERINC')
BEGIN
  CREATE DATABASE CHARTERINC;
END;

Go

USE CHARTERINC;
Go

IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='AIRCRAFT')
BEGIN
CREATE TABLE [dbo].AIRCRAFT(
	[AC_NUMBER] [nvarchar](5),
	[MOD_CODE] [nvarchar](10),
	[AC_TTAF] [float](8),
	[AC_TTEL] [float](8),
	[AC_TTER] [float](8),
	CONSTRAINT [PK_AIRCRAFT] PRIMARY KEY (AC_NUMBER)
 );
END;

IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='CHARTER')
BEGIN
CREATE TABLE [dbo].CHARTER(
	[CHAR_TRIP] [bigint],
	[CHAR_DATE] [datetime],
	[AC_NUMBER] [nvarchar](5),
	[CHAR_DESTINATION] [nvarchar](3),
	[CHAR_DISTANCE] [smallint],
	[CHAR_HOURS_FLOWN] [float](8),
	[CHAR_HOURS_WAIT] [float](8),
	[CHAR_FUEL_GALLONS] [float](8),
	[CHAR_OIL_QTS] [int],
	[CUS_CODE] [bigint],
	CONSTRAINT [PK_CHARTER] PRIMARY KEY (CHAR_TRIP)
 );
END;

IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='CREW')
BEGIN
CREATE TABLE [dbo].CREW(
	[CHAR_TRIP] [bigint],
	[EMP_NUM] [bigint],
	[CREW_JOB] [nvarchar](20),
	CONSTRAINT [PK_CREW] PRIMARY KEY (CHAR_TRIP, EMP_NUM)
 );
END;

IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='CUSTOMER')
BEGIN
CREATE TABLE [dbo].CUSTOMER(
	[CUS_CODE] [bigint],
	[CUS_LNAME] [nvarchar](15),
	[CUS_FNAME] [nvarchar](15),
	[CUS_INITIAL] [nvarchar](1),
	[CUS_AREACODE] [nvarchar](3),
	[CUS_PHONE] [nvarchar](8),
	[CUS_BALANCE] [smallint],
	CONSTRAINT [PK_CUSTOMER] PRIMARY KEY (CUS_CODE)
 );
END;

IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='EMPLOYEE')
BEGIN
CREATE TABLE [dbo].EMPLOYEE(
	[EMP_NUM] [bigint],
	[EMP_TITLE] [nvarchar](4),
	[EMP_LNAME] [nvarchar](15),
	[EMP_FNAME] [nvarchar](15),
	[EMP_INITIAL] [nvarchar](1),
	[EMP_DOB] [datetime],
	[EMP_HIRE_DATE] [datetime],
	CONSTRAINT [PK_EMPLOYEE] PRIMARY KEY (EMP_NUM)
 );
END;

IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='MODEL')
BEGIN
CREATE TABLE [dbo].MODEL(
	[MOD_CODE] [nvarchar](10),
	[MOD_MANUFACTURER] [nvarchar](15),
	[MOD_NAME] [nvarchar](20),
	[MOD_SEATS] [float](8),
	[MOD_CHG_MILE] [smallint],
	CONSTRAINT [PK_MODEL] PRIMARY KEY (MOD_CODE)
 );
END;

Go

ALTER TABLE CREW
ADD CONSTRAINT FK_EMPLOYEE_CREW FOREIGN KEY (EMP_NUM) REFERENCES EMPLOYEE(EMP_NUM) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE CREW
ADD CONSTRAINT FK_CHARTER_CREW FOREIGN KEY (CHAR_TRIP) REFERENCES CHARTER(CHAR_TRIP) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE AIRCRAFT
ADD CONSTRAINT FK_MODEL_AIRCRAFT FOREIGN KEY (MOD_CODE) REFERENCES MODEL(MOD_CODE) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE CHARTER
ADD CONSTRAINT FK_AIRCRAFT_CHARTER FOREIGN KEY (AC_NUMBER) REFERENCES AIRCRAFT(AC_NUMBER) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE CHARTER
ADD CONSTRAINT FK_CUSTOMER_CHARTER FOREIGN KEY (CUS_CODE) REFERENCES CUSTOMER(CUS_CODE) ON UPDATE CASCADE ON DELETE CASCADE;

Go


INSERT INTO MODEL (MOD_CODE,MOD_MANUFACTURER,MOD_NAME,MOD_SEATS,MOD_CHG_MILE) VALUES ('C-90A','Beechcraft','KingAir',8.00,2.67);
INSERT INTO MODEL (MOD_CODE,MOD_MANUFACTURER,MOD_NAME,MOD_SEATS,MOD_CHG_MILE) VALUES ('PA23-250','Piper','Aztec',6.00,1.93);
INSERT INTO MODEL (MOD_CODE,MOD_MANUFACTURER,MOD_NAME,MOD_SEATS,MOD_CHG_MILE) VALUES ('PA31-350','Piper','Navajo Chieftain',10.00,2.35);
Go

INSERT INTO AIRCRAFT (AC_NUMBER,MOD_CODE,AC_TTAF,AC_TTEL,AC_TTER) VALUES ('1484P','PA23-250',1833.10,1833.10,101.80);
INSERT INTO AIRCRAFT (AC_NUMBER,MOD_CODE,AC_TTAF,AC_TTEL,AC_TTER) VALUES ('2289L','C-90A',4243.80,768.90,1123.40);
INSERT INTO AIRCRAFT (AC_NUMBER,MOD_CODE,AC_TTAF,AC_TTEL,AC_TTER) VALUES ('2778V','PA31-350',7992.90,1513.10,789.50);
INSERT INTO AIRCRAFT (AC_NUMBER,MOD_CODE,AC_TTAF,AC_TTEL,AC_TTER) VALUES ('4278Y','PA31-350',2147.30,622.10,243.20);
Go

INSERT INTO CUSTOMER (CUS_CODE,CUS_LNAME,CUS_FNAME,CUS_INITIAL,CUS_AREACODE,CUS_PHONE,CUS_BALANCE) VALUES (10010,'Ramas','Alfred','A','615','844-2573',0.00);
INSERT INTO CUSTOMER (CUS_CODE,CUS_LNAME,CUS_FNAME,CUS_INITIAL,CUS_AREACODE,CUS_PHONE,CUS_BALANCE) VALUES (10011,'Dunne','Leona','K','713','894-1238',0.00);
INSERT INTO CUSTOMER (CUS_CODE,CUS_LNAME,CUS_FNAME,CUS_INITIAL,CUS_AREACODE,CUS_PHONE,CUS_BALANCE) VALUES (10012,'Smith','Kathy','W','615','894-2285',896.54);
INSERT INTO CUSTOMER (CUS_CODE,CUS_LNAME,CUS_FNAME,CUS_INITIAL,CUS_AREACODE,CUS_PHONE,CUS_BALANCE) VALUES (10013,'Olowski','Paul','F','615','894-2180',1285.19);
INSERT INTO CUSTOMER (CUS_CODE,CUS_LNAME,CUS_FNAME,CUS_INITIAL,CUS_AREACODE,CUS_PHONE,CUS_BALANCE) VALUES (10014,'Orlando','Myron',NULL,'615','222-1672',673.21);
INSERT INTO CUSTOMER (CUS_CODE,CUS_LNAME,CUS_FNAME,CUS_INITIAL,CUS_AREACODE,CUS_PHONE,CUS_BALANCE) VALUES (10015,'O''Brian','Amy','B','713','442-3381',1014.56);
INSERT INTO CUSTOMER (CUS_CODE,CUS_LNAME,CUS_FNAME,CUS_INITIAL,CUS_AREACODE,CUS_PHONE,CUS_BALANCE) VALUES (10016,'Brown','James','G','615','297-1228',0.00);
INSERT INTO CUSTOMER (CUS_CODE,CUS_LNAME,CUS_FNAME,CUS_INITIAL,CUS_AREACODE,CUS_PHONE,CUS_BALANCE) VALUES (10017,'Williams','George',NULL,'615','290-2556',0.00);
INSERT INTO CUSTOMER (CUS_CODE,CUS_LNAME,CUS_FNAME,CUS_INITIAL,CUS_AREACODE,CUS_PHONE,CUS_BALANCE) VALUES (10018,'Farriss','Anne','G','713','382-7185',0.00);
INSERT INTO CUSTOMER (CUS_CODE,CUS_LNAME,CUS_FNAME,CUS_INITIAL,CUS_AREACODE,CUS_PHONE,CUS_BALANCE) VALUES (10019,'Smith','Olette','K','615','297-3809',453.98);
Go

INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10001,'20160205 00:00:00','2289L','ATL',936.00,5.10,2.20,354.10,1,10011);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10002,'20160205 00:00:00','2778V','BNA',320.00,1.60,0.00,72.60,0,10016);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10003,'20160205 00:00:00','4278Y','GNV',1574.00,7.80,0.00,339.80,2,10014);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10004,'20160206 00:00:00','1484P','STL',472.00,2.90,4.90,97.20,1,10019);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10005,'20160206 00:00:00','2289L','ATL',1023.00,5.70,3.50,397.70,2,10011);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10006,'20160206 00:00:00','4278Y','STL',472.00,2.60,5.20,117.10,0,10017);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10007,'20160206 00:00:00','2778V','GNV',1574.00,7.90,0.00,348.40,2,10012);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10008,'20160207 00:00:00','1484P','TYS',644.00,4.10,0.00,140.60,1,10014);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10009,'20160207 00:00:00','2289L','GNV',1574.00,6.60,23.40,459.90,0,10017);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10010,'20160207 00:00:00','4278Y','ATL',998.00,6.20,3.20,279.70,0,10016);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10011,'20160207 00:00:00','1484P','BNA',352.00,1.90,5.30,66.40,1,10012);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10012,'20160208 00:00:00','2778V','MOB',884.00,4.80,4.20,215.10,0,10010);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10013,'20160208 00:00:00','4278Y','TYS',644.00,3.90,4.50,174.30,1,10011);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10014,'20160209 00:00:00','4278Y','ATL',936.00,6.10,2.10,302.60,0,10017);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10015,'20160209 00:00:00','2289L','GNV',1645.00,6.70,0.00,459.50,2,10016);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10016,'20160209 00:00:00','2778V','MQY',312.00,1.50,0.00,67.20,0,10011);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10017,'20160210 00:00:00','1484P','STL',508.00,3.10,0.00,105.50,0,10014);
INSERT INTO CHARTER 
(CHAR_TRIP,CHAR_DATE,AC_NUMBER,CHAR_DESTINATION,CHAR_DISTANCE,CHAR_HOURS_FLOWN,CHAR_HOURS_WAIT,CHAR_FUEL_GALLONS,CHAR_OIL_QTS,CUS_CODE)
VALUES (10018,'20160210 00:00:00','4278Y','TYS',644.00,3.80,4.50,167.40,0,10017);
Go

INSERT INTO EMPLOYEE (EMP_NUM,EMP_TITLE,EMP_LNAME,EMP_FNAME,EMP_INITIAL,EMP_DOB,EMP_HIRE_DATE) 
VALUES (100,'Mr.','Kolmycz','George','D','19520615 00:00:00','20070315 00:00:00');
INSERT INTO EMPLOYEE (EMP_NUM,EMP_TITLE,EMP_LNAME,EMP_FNAME,EMP_INITIAL,EMP_DOB,EMP_HIRE_DATE) 
VALUES (101,'Ms.','Lewis','Rhonda','G','19750319 00:00:00','20080425 00:00:00');
INSERT INTO EMPLOYEE (EMP_NUM,EMP_TITLE,EMP_LNAME,EMP_FNAME,EMP_INITIAL,EMP_DOB,EMP_HIRE_DATE) 
VALUES (102,'Mr.','VanDam','Rhett',NULL,'19681114 00:00:00','20121220 00:00:00');
INSERT INTO EMPLOYEE (EMP_NUM,EMP_TITLE,EMP_LNAME,EMP_FNAME,EMP_INITIAL,EMP_DOB,EMP_HIRE_DATE) 
VALUES (103,'Ms.','Jones','Anne','M','19841016 00:00:00','20150828 00:00:00');
INSERT INTO EMPLOYEE (EMP_NUM,EMP_TITLE,EMP_LNAME,EMP_FNAME,EMP_INITIAL,EMP_DOB,EMP_HIRE_DATE) 
VALUES (104,'Mr.','Lange','John','P','19811108 00:00:00','20061020 00:00:00');
INSERT INTO EMPLOYEE (EMP_NUM,EMP_TITLE,EMP_LNAME,EMP_FNAME,EMP_INITIAL,EMP_DOB,EMP_HIRE_DATE) 
VALUES (105,'Mr.','Williams','Robert','D','19850314 00:00:00','20150108 00:00:00');
INSERT INTO EMPLOYEE (EMP_NUM,EMP_TITLE,EMP_LNAME,EMP_FNAME,EMP_INITIAL,EMP_DOB,EMP_HIRE_DATE) 
VALUES (106,'Mrs.','Duzak','Jeanine','K','19780212 00:00:00','20110105 00:00:00');
INSERT INTO EMPLOYEE (EMP_NUM,EMP_TITLE,EMP_LNAME,EMP_FNAME,EMP_INITIAL,EMP_DOB,EMP_HIRE_DATE) 
VALUES (107,'Mr.','Diante','Jorge','D','19840821 00:00:00','20060702 00:00:00');
INSERT INTO EMPLOYEE (EMP_NUM,EMP_TITLE,EMP_LNAME,EMP_FNAME,EMP_INITIAL,EMP_DOB,EMP_HIRE_DATE) 
VALUES (108,'Mr.','Wiesenbach','Paul','R','19760214 00:00:00','20141118 00:00:00');
INSERT INTO EMPLOYEE (EMP_NUM,EMP_TITLE,EMP_LNAME,EMP_FNAME,EMP_INITIAL,EMP_DOB,EMP_HIRE_DATE) 
VALUES (109,'Ms.','Travis','Elizabeth','K','19710618 00:00:00','20110414 00:00:00');
INSERT INTO EMPLOYEE (EMP_NUM,EMP_TITLE,EMP_LNAME,EMP_FNAME,EMP_INITIAL,EMP_DOB,EMP_HIRE_DATE) 
VALUES (110,'Mrs.','Genkazi','Leighla','W','19800519 00:00:00','20121201 00:00:00');
Go

INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10001,104,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10002,101,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10003,105,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10003,109,'Copilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10004,106,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10005,101,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10006,109,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10007,104,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10007,105,'Copilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10008,106,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10009,105,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10010,108,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10011,101,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10011,104,'Copilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10012,101,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10013,105,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10014,106,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10015,101,'Copilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10015,104,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10016,105,'Copilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10016,109,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10017,101,'Pilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10018,104,'Copilot');
INSERT INTO CREW (CHAR_TRIP,EMP_NUM,CREW_JOB) VALUES (10018,105,'Pilot');
Go

CREATE PROCEDURE spAddAircraft
@ACNum nvarchar(5) = NULL,
@ModCode nvarchar(10) = NULL,
@TTAF float(8) = NULL,
@TTEL float(8) = NULL,
@TTER float(8) = NULL
AS
INSERT INTO AIRCRAFT (AC_NUMBER,MOD_CODE,AC_TTAF,AC_TTEL,AC_TTER) VALUES (@ACNum, @ModCode, @TTAF, @TTEL, @TTER);
Go

EXECUTE spAddAircraft '2290L', 'C-90A', 4243.8, 768.9, 1123.4;
Go

CREATE VIEW CharterAircraft AS
SELECT AC_NUMBER,MOD_CODE,AC_TTAF,AC_TTEL,AC_TTER
FROM AIRCRAFT
WHERE AC_NUMBER NOT IN (SELECT AC_NUMBER FROM CHARTER);
Go

SELECT CUSTOMER.CUS_FNAME, CUSTOMER.CUS_LNAME, CUSTOMER.CUS_BALANCE, SUM (CHAR_HOURS_FLOWN) AS TOTAL_HOURS_FLOWN
FROM CHARTER
INNER JOIN CUSTOMER
ON CHARTER.CUS_CODE = CUSTOMER.CUS_CODE
GROUP BY CHARTER.CUS_CODE, CUS_FNAME, CUS_LNAME, CUSTOMER.CUS_BALANCE
HAVING SUM (CHAR_HOURS_FLOWN) > 7;
Go

WITH Customer_cte (CUS_CODE, TOTAL_HOURS_FLOWN)
AS
(
SELECT CUS_CODE, SUM (CHAR_HOURS_FLOWN) AS TOTAL_HOURS_FLOWN
FROM CHARTER
GROUP BY CUS_CODE
HAVING SUM (CHAR_HOURS_FLOWN) > 7
)
SELECT CUSTOMER.CUS_FNAME, CUSTOMER.CUS_LNAME, CUSTOMER.CUS_BALANCE, TOTAL_HOURS_FLOWN
FROM CUSTOMER
INNER JOIN Customer_cte
ON Customer_cte.CUS_CODE = CUSTOMER.CUS_CODE;
Go